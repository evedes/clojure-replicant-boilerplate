{"version":3,"sources":["dumdom/core.cljs"],"mappings":";;AAQA;;;;AAAeA,4BAGb,6CAAA,7CAACC;AAEH;;;AAAeC,yBAEb,6CAAA,7CAACD;AAEH,AAAeE,+BAAW,6CAAA,7CAACF;AAE3B;;;AAAKG,oBAEH,qDAAA,rDAACC,sDAAmBC,qEACAC,iEACAC,4DACAC,4DACAC;AAEtB,0BAAA,1BAAMC,4DAAaC;AAAnB,AACE,QAAM,AAAA,AAAQA,2BAA4B,AAACC,mDAAMX,uBAAWY;;AAE9D,wBAAA,xBAAMC,wDAAWH;AAAjB,AACE,IAAAI,WAAgB,AAAA,AAAQJ;IAAxBK,eAAA,AAAAC,gBAAElB;AAAF,AAAA,QAAAiB,6CAAAA,2CAAAD,YAAAC,wBAAAD;;AAEF,6BAAA,7BAAMG,kEAAgBC,WAAWC;AAAjC,AACE,OAACR,mDAAMb,0BAAcsB,gBAAMF,WAAWC;;AAExC,+BAAA,/BAAME,sEAAkBH;AAAxB,AACE,OAACP,mDAAMb,0BAAcwB,iBAAOJ;;AAE9B;;;;;8BAAA,9BAAOK,oEAIJb;AAJH,AAKE,qBAAA,pBAAM,AAAaA;;AACnB,AAACD,wBAAYC;;AACb,OAAqBA;;AAEvB,0BAAA,1BAAMc;AAAN,AACE,uDAAA,hDAACC,sBAAO3B;;AAEV,0BAAA,uDAAA4B,jFAAOI,4DAAaC,UAAUb;AAA9B,AAAA,IAAAS,aAAAD;IAAAC,iBAAA,AAAAC,4BAAAD;mBAAA,AAAAE,4CAAAF,eAAA,1EAAiDK;AAAjD,AAME,IAAAC,qBAAqB,AAACC,8BAAiBH;AAAvC,AAAA,oBAAAE;AAAA,AAAA,oBAAAA,hBAAWF;AAAX,AACE,IAAAI,2CAAUE;IAAVD,2CAA2B,iBAAAE,mBAAIN;AAAJ,AAAA,oBAAAM;AAAAA;;AAAiBD;;;AAA5C,AAAA,2CAAAD,1CAAUC;;AAAV,IAAA,AACE,IAAAE,WAAQ,iBAAAC,WAAA,mFAAYtB;IAAZuB,WAAA;AAAA,AAAA,kGAAAD,SAAAC,qCAAAD,SAAAC,jJAACV,8CAAAA,iEAAAA;;AAAT,AAAA,GAAA,CAAAQ,YAAA;AAAA;;AAAA,4BAAAA,rBAAoCG;;UADtC,AAAA,2CAAAP,1CAAUE;;AADZ;;;AAIF,sCAAA,tCAAMM,oFAAoBC;AAA1B,AACE,oBAAM,iBAAAC,oBAAKD;AAAL,AAAA,oBAAAC;AAAO,UAAK,AAACC,qBAAKF;;AAAlBC;;;AAAN,AACE,MAAO,gDAAA,mCAAA,2CAAA,9HAACE,8KAA+CH;;AADzD;;AAEA,QAAMP,0CAAiBO;;AAEzB;;;kCAAA,lCAAeI,4EAEZC,EAAEC;AAFL,AAGE,oBAAIb;AACF,oBAAA,AAAArB,gBAAKf;AACH,6BAAA,tBAACkD;AAAD,AAA2B,OAACd,mDAAiBY,EAAEC;;;AAC/C,OAACb,mDAAiBY,EAAEC;;;AACtB,MAAO,KAAAE,MAAA;;;;AAEX,AAAA;;;;qBAAA,6BAAAC,lDAAMM;AAAN,AAAA,IAAAL,qBAAA;AAAA,AAAA,IAAAC,0BAAA,AAAA;AAAA,AAAA,IAAAC,wBAAA;;AAAA,AAAA,GAAA,CAAAA,wBAAAD;AAAA,AAAA,AAAAD,wBAAA,CAAA,UAAAE;;AAAA,eAAA,CAAAA,wBAAA;;;;AAAA;;;;AAAA,IAAAC,uBAAA,EAAA,CAAA,MAAA,AAAAH,4BAAA,AAAA,KAAAI,qBAAA,AAAAJ,yBAAA,KAAA,IAAA,OAAA;AAAA,AAAA,OAAAK,wDAAA,CAAA,UAAA,MAAA,CAAA,UAAA,MAAAF;;;AAAA,AAAA,CAAA,0DAAA,6BAAAG,vFAAMD,qEAGH5B,UAAUrB;AAHb,AAAA,IAAAmD,aAAAD;UAAA,AAAAE,4CAAAD,WAAA,IAAA,jEAGwBQ;AAHxB,AAIE,mDAAA,nDAAC5C,sBAAOxB;;AACR,oBAAM,iBAAA4C,oBAAK,AAAA,mGAAewB;AAApB,AAAA,oBAAAxB;AAAyB,UAAK,AAACC,qBAAK,AAAA,mGAAeuB;;AAAnDxB;;;AAAN,AACE,MAAO,gDAAA,hDAACE,uHAA+EsB;;AADzF;;AAEA,IAAMC,eAAa,iBAAAhC,mBAAI,AAACzB,sBAAUH;AAAf,AAAA,oBAAA4B;AAAAA;;AAAwB,OAACf,4BAAWb;;;IACjDQ,aAAW,AAAA,AAAQR;AADzB,AAEE,IAAA6D,2BAAe,AAACzC,wBAAYC,UAAUb,WAAWmD;AAAjD,AAAA,oBAAAE;AAAA,kBAAAA,dAASpD;AAAT,AACE,AAQE,oBAAU,AAAIA;AAAd;AAAA,AACE,mBAAA,lBAAM,AAAIA;;;AACZ,CAACjB,kDAAAA,4EAAAA,5BAAMoE,yDAAAA,5CAAanD,yDAAAA;;AACpB,AAACF,2BAAeC,WAAWC;;AAC7B,AACE,qBAAA,pBAAM,AAAaT;;AACnB,AAACW,6BAAiBH;;;AACtB,oBAAMsD;AAAN,AACE,oEAAA,pEAAC/C,sBAAOgD;;AADV;;AAEA,0DAAA,nDAAChD,sBAAOxB;;;AA3BZ,CAAA,6CAAA,7CAAM0D;;AAAN;AAAA,CAAA,uCAAA,WAAAI,lDAAMJ;AAAN,AAAA,IAAAK,WAAA,AAAAC,gBAAAF;IAAAA,eAAA,AAAAG,eAAAH;IAAAI,WAAA,AAAAF,gBAAAF;IAAAA,eAAA,AAAAG,eAAAH;AAAA,AAAA,IAAAK,qBAAA;AAAA,AAAA,OAAAA,wDAAAJ,SAAAG,SAAAJ;;;AAAA,AA6BA,AAAA;;;;;;0BAAA,kCAAAV,5DAAMqB;AAAN,AAAA,IAAApB,qBAAA;AAAA,AAAA,IAAAC,0BAAA,AAAA;AAAA,AAAA,IAAAC,wBAAA;;AAAA,AAAA,GAAA,CAAAA,wBAAAD;AAAA,AAAA,AAAAD,wBAAA,CAAA,UAAAE;;AAAA,eAAA,CAAAA,wBAAA;;;;AAAA;;;;AAAA,IAAAC,uBAAA,EAAA,CAAA,MAAA,AAAAH,4BAAA,AAAA,KAAAI,qBAAA,AAAAJ,yBAAA,KAAA,IAAA,OAAA;AAAA,AAAA,OAAAoB,6DAAA,CAAA,UAAA,MAAA,CAAA,UAAA,MAAAjB;;;AAAA,AAAA,CAAA,+DAAA,6BAAAkB,5FAAMD,0EAKH3C,UAAUrB;AALb,AAAA,IAAAkE,aAAAD;UAAA,AAAAb,4CAAAc,WAAA,IAAA,jEAKwBP;AALxB,AAME,mDAAA,nDAAC5C,sBAAOxB;;AACR,oBAAM,iBAAA4C,oBAAK,AAAA,mGAAewB;AAApB,AAAA,oBAAAxB;AAAyB,UAAK,AAACC,qBAAK,AAAA,mGAAeuB;;AAAnDxB;;;AAAN,AACE,MAAO,gDAAA,hDAACE,4HAAoFsB;;AAD9F;;AAEA,IAAMC,qBAAa,AAAC/C,4BAAWb;IACzBQ,mBAAW,AAAA,AAAQR;AADzB,AAEE,IAAAuB,2BAAiB,AAACH,wBAAYC,UAAUb,iBAAWmD;AAAnD,AAAA,oBAAApC;AAAA,AAAA,kBAAAA,dAAWd;AAAX,AACE,CAACjB,kDAAAA,kFAAAA,lCAAMoE,+DAAAA,5CAAanD,+DAAAA;;AADtB;;AAEA,oBAAMqD;AAAN,AACE,oEAAA,pEAAC/C,sBAAOgD;;AADV;;AAEF,0DAAA,nDAAChD,sBAAOxB;;;AAfV,CAAA,kDAAA,lDAAMyE;;AAAN;AAAA,CAAA,4CAAA,WAAAG,vDAAMH;AAAN,AAAA,IAAAI,WAAA,AAAAb,gBAAAY;IAAAA,eAAA,AAAAX,eAAAW;IAAAE,WAAA,AAAAd,gBAAAY;IAAAA,eAAA,AAAAX,eAAAW;AAAA,AAAA,IAAAT,qBAAA;AAAA,AAAA,OAAAA,wDAAAU,SAAAC,SAAAF;;;AAAA,AAiBA;;;sBAAA,tBAAMG,oDAEHtE;AAFH,AAGE,oCAAA,AAAA,AAAQA,7BAA6BW;;AAEvC,AAAK4D,wBAAUC;AACf,AAAKC,+BAAWC;AAChB,AAAKC,4BAAcC;AAEnB,8BAAA,9BAAMC,oEAAiBlB,IAAImB;AAA3B,AACE,OAACC,iCAA0BC,cAAKrB,IAAImB;;AAEtC,iCAAA,jCAAMG,0EAAoBtB,IAAImB;AAA9B,AACE,OAACI,oCAA6BF,cAAKrB,IAAImB","names":["dumdom.core/current-nodes","cljs.core.atom","dumdom.core/element-id","dumdom.core/rendering?","dumdom.core/patch","js/module$node_modules$snabbdom$build$snabbdom_cjs.init","js/module$node_modules$snabbdom$build$snabbdom_cjs.eventListenersModule","js/module$node_modules$snabbdom$build$snabbdom_cjs.attributesModule","js/module$node_modules$snabbdom$build$snabbdom_cjs.propsModule","js/module$node_modules$snabbdom$build$snabbdom_cjs.styleModule","js/module$node_modules$snabbdom$build$snabbdom_cjs.datasetModule","dumdom.core/set-root-id","element","cljs.core.swap_BANG_","cljs.core/inc","dumdom.core/root-node","G__49742","fexpr__49741","cljs.core/deref","dumdom.core/register-vnode","element-id","vnode","cljs.core/assoc","dumdom.core/unregister-vnode","cljs.core/dissoc","dumdom.core/init-node!","dumdom.core/purge!","cljs.core/reset!","p__49748","map__49749","cljs.core/--destructure-map","cljs.core.get","dumdom.core/create-vdom","component","handle-event","temp__5823__auto__","dumdom.element/inflate-hiccup","*handle-event*-orig-val__49754","*handle-event*-temp-val__49755","dumdom.element/*handle-event*","or__5002__auto__","G__49756","G__49757","G__49758","cljs.core/clj->js","dumdom.core/set-event-handler!","f","and__5000__auto__","cljs.core/ifn?","cljs.core.ex_info","dumdom.core/dispatch-event-data","e","data","js/requestAnimationFrame","js/Error","var_args","args__5732__auto__","len__5726__auto__","i__5727__auto__","argseq__5733__auto__","cljs.core/IndexedSeq","dumdom.core/render","p__49775","vec__49776","cljs.core.nth","seq49765","G__49766","cljs.core/first","cljs.core/next","G__49767","self__5711__auto__","opt","current-node","temp__5821__auto__","dumdom.component/*render-eagerly?*","dumdom.component/eager-render-required?","dumdom.core/render-once","p__49787","vec__49788","seq49782","G__49783","G__49784","dumdom.core/unmount","dumdom.core/component","dumdom.component/component","dumdom.core/component?","dumdom.component/component?","dumdom.core/render-string","dumdom.string/render","dumdom.core/TransitionGroup","children","dumdom.component/TransitionGroup","dumdom.dom/el","dumdom.core/CSSTransitionGroup","dumdom.component/CSSTransitionGroup"],"sourcesContent":["(ns dumdom.core\n  (:require [dumdom.component :as component]\n            [dumdom.dom :as d]\n            [dumdom.element :as e]\n            [dumdom.string :as string]\n            [snabbdom :as snabbdom])\n  (:require-macros [dumdom.core]))\n\n(def ^:private current-nodes\n  \"A mapping from root DOM nodes to currently rendered virtual DOM trees. Used to\n  reconcile (render component dom-node) to (patch old-vdom new-vdom)\"\n  (atom {}))\n\n(def ^:private element-id\n  \"A counter used to assign unique ids to root elements\"\n  (atom -1))\n\n(def ^:private rendering? (atom false))\n\n(def patch\n  \"The snabbdom patch function used by render\"\n  (snabbdom/init #js [snabbdom/eventListenersModule\n                      snabbdom/attributesModule\n                      snabbdom/propsModule\n                      snabbdom/styleModule\n                      snabbdom/datasetModule]))\n\n(defn set-root-id [element]\n  (set! (.. ^js element -dataset -dumdomId) (swap! element-id inc)))\n\n(defn root-node [element]\n  (@current-nodes (.. ^js element -dataset -dumdomId)))\n\n(defn register-vnode [element-id vnode]\n  (swap! current-nodes assoc element-id vnode))\n\n(defn unregister-vnode [element-id]\n  (swap! current-nodes dissoc element-id))\n\n(defn- init-node!\n  \"Snabbdom will replace the element provided as the original target for patch.\n  When rendering into a new DOM node, we therefore create an intermediate in it\n  and use that as Snabbdom's root, to avoid destroying the provided root node.\"\n  [element]\n  (set! (.-innerHTML element) \"<div></div>\")\n  (set-root-id element)\n  (.-firstElementChild element))\n\n(defn purge! []\n  (reset! current-nodes {}))\n\n(defn- create-vdom [component element-id {:keys [handle-event]}]\n  ;; The handle event function must be bound dynamically here\n  ;; because the data structure containing event data to pass to\n  ;; it was already built before render was called. This binding\n  ;; avoids having to walk the entire vdom structure before\n  ;; passing it to snabbdom.\n  (when-let [component (e/inflate-hiccup component)]\n    (binding [e/*handle-event* (or handle-event e/*handle-event*)]\n      (some-> (component [element-id] {}) clj->js))))\n\n(defn set-event-handler! [f]\n  (when (and f (not (ifn? f)))\n    (throw (ex-info \"Event handler must be a function\" {:f f})))\n  (set! e/*handle-event* f))\n\n(defn ^:export dispatch-event-data\n  \"Dispatch\"\n  [e data]\n  (if e/*handle-event*\n    (if @rendering?\n      (js/requestAnimationFrame #(e/*handle-event* e data))\n      (e/*handle-event* e data))\n    (throw (js/Error. \"Cannot dispatch custom event data without a global event handler. Call dumdom.core/set-event-handler!\"))))\n\n(defn render\n  \"Render the virtual DOM node created by the component into the specified DOM\n  element, and mount it for fast future re-renders.\"\n  [component element & [opt]]\n  (reset! rendering? true)\n  (when (and (:handle-event opt) (not (ifn? (:handle-event opt))))\n    (throw (ex-info \"Called dumdom.core/render with a handle-event that is not a function\" opt)))\n  (let [current-node (or (root-node element) (init-node! element))\n        element-id (.. ^js element -dataset -dumdomId)]\n    (if-let [vnode (create-vdom component element-id opt)]\n      (do\n        ;; If the root node does not have a key, Snabbdom will consider it the\n        ;; same node as the node it is rendered into if they have the same tag\n        ;; name (typically root nodes are divs, and typically they are rendered\n        ;; into divs). When this happens, Snabbdom fires the update hook rather\n        ;; than the insert hook, which breaks dumdom's contract. Forcing the\n        ;; root node to have a key circumvents this problem and ensures the root\n        ;; node has its insert hooks fired on initial render.\n        (when-not (.. vnode -key)\n          (set! (.. vnode -key) \"root-node\"))\n        (patch current-node vnode)\n        (register-vnode element-id vnode))\n      (do\n        (set! (.-innerHTML element) \"\")\n        (unregister-vnode element-id)))\n    (when component/*render-eagerly?*\n      (reset! component/eager-render-required? false))\n    (reset! rendering? false)))\n\n(defn render-once\n  \"Like render, but without mounting the element for future updates. This should\n  only be used when you don't expect to re-render the component into the same\n  element. Subsequent calls to render into the same element will always cause a\n  full rebuild of the DOM. This function does not acumulate state.\"\n  [component element & [opt]]\n  (reset! rendering? true)\n  (when (and (:handle-event opt) (not (ifn? (:handle-event opt))))\n    (throw (ex-info \"Called dumdom.core/render-once with a handle-event that is not a function\" opt)))\n  (let [current-node (init-node! element)\n        element-id (.. ^js element -dataset -dumdomId)]\n    (when-let [vnode (create-vdom component element-id opt)]\n      (patch current-node vnode))\n    (when component/*render-eagerly?*\n      (reset! component/eager-render-required? false)))\n  (reset! rendering? false))\n\n(defn unmount\n  \"Unmount an element previously mounted by dumdom.core/render\"\n  [element]\n  (-> ^js element .-dataset .-dumdomId unregister-vnode))\n\n(def component component/component)\n(def component? component/component?)\n(def render-string string/render)\n\n(defn TransitionGroup [opt children]\n  (component/TransitionGroup d/el opt children))\n\n(defn CSSTransitionGroup [opt children]\n  (component/CSSTransitionGroup d/el opt children))\n"],"x_google_ignoreList":[0]}